author: "kubiyamg@gmail.com"
version: 3
type: "conversation"
name: "search S3 for file in a given location"
steps:
  - id: "get_s3_buckets"
    type: "action"
    action:
      store: "aws"
      name: "s3.ListBuckets"
      runner: "runner02"
      parameters: {}
  - id: "s3_buckets"
    type: "jq"
    jq: ".get_s3_buckets.Buckets[].Name"
  - id: "s3_bucket"
    type: "input"
    value_type: "enum"
    prompt: "Select the S3 bucket you want to search in"
    possible_values: "${s3_buckets}"
  - id: "s3_file_name"
    type: "input"
    value_type: "text"
    prompt: "Enter the file name you want to search for"
  - id: "get_s3_files"
    type: "action"
    action:
      store: "aws"
      name: "s3.ListObjectsV2"
      runner: "runner02"
      parameters:
        Bucket: "${s3_bucket}"
  - id: "s3_files"
    type: "jq"
    jq: ".get_s3_files.Contents[].Key"
  - id: "s3_file"
    type: "input"
    value_type: "enum"
    prompt: "Select the file you want to see details for"
    possible_values: "${s3_files}"
  - id: "get_s3_file"
    type: "action"
    action:
      store: "aws"
      name: "s3.GetObject"
      runner: "runner02"
      parameters:
        Bucket: "${s3_bucket}"
        Key: "${s3_file}"
  - id: "s3_file_content"
    type: "json_message"
    prompt: "${get_s3_file}"
