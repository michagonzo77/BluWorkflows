author: "kubiyamg@gmail.com"
version: 3
type: "conversation"
name: "ec2 template test"
steps:
  - id: "get_ec2_instances"
    type: "action"
    action:
      runner: "runner02"
      store: "aws"
      name: "ec2_list_instances"
      parameters: {}
  - id: "ec2_instances"
    type: "jq"
    jq: ".get_ec2_instances.Reservations[].Instances[].InstanceId"
  - id: "ec2_instance"
    type: "input"
    value_type: "enum"
    prompt: "Select the EC2 instance you want to create a template from"
    possible_values: "${ec2_instances}"
  - id: "ec2_instance_name"
    type: "jq"
    jq: ".get_ec2_instances.Reservations[].Instances[] | select(.InstanceId == \"${ec2_instance}\") | .Tags[] | select(.Key == \"Name\") | .Value"
  - id: "ec2_instance_details"
    type: "message"
    prompt: "*EC2 instance details:*\n*Name:* ${ec2_instance_name}\n"
  - id: "ec2_instance_template_name"
    type: "input"
    value_type: "text"
    prompt: "Enter the name of the template you want to create"
  - id: "create_ec2_instance_template"
    type: "action"
    action:
      runner: "runner02"
      store: "aws"
      name: "ec2.CreateImage"
      parameters:
        InstanceId: "${ec2_instance}"
        Name: "${ec2_instance_template_name}"
  - id: "success"
    type: "message"
    prompt: "âœ… *Done!*\nCreated EC2 instance template *${ec2_instance_template_name}* from instance *${ec2_instance}* succesfully!\n"
